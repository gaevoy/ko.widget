!function(n){"function"==typeof define&&define.amd?define(["knockout","jquery"],n):n(ko,jQuery)}(function(n,i){function t(t,e){var o=this,d=null;this.exportMethods=function(){for(var n=arguments,i=0;i<n.length;i++){var e=n[i];t&&t[e]&&(o[e]=t[e])}},this.init=function(){return t.init?t.init.apply(t,arguments):void 0},this.appendTo=function(o){d=i(o);var a=i(e);if(d.append(a),null==t)throw new Error("Widget can not be attached because of viewModel is null");n.applyBindings(t,a[0]),t.bound&&t.bound()},this.dispose=function(){d&&d[0]&&(t.unbound&&t.unbound(),t.dispose&&t.dispose(),n.cleanNode(d[0]),d=null)}}function e(i,t){return 2!=arguments.length?n.utils.domData.get(i,p):(n.utils.domData.set(i,p,t),void 0)}function o(t,o){function d(o){r&&r.dispose();var d=null;r=o,r&&(d=i('<div class="widget"></div>'),d.appendTo(s),r.appendTo(d),a(d,r)),e(t,r);var u=d?d.prev():s.children().last();n.bindingHandlers.inject.transition(u,d,s)}var s=i(t),r=null,u=null;d(n.unwrap(o)),n.isObservable(o)&&(u=o.subscribe(d)),n.utils.domNodeDisposal.addDisposeCallback(t,function(){u&&u.dispose(),r&&r.dispose(),e(t,null)})}function d(n){if(n.name)return n.name;var i=n.toString().split("\n")[0],t=/^function ([^\s(]+).+/;return t.test(i)?i.split("\n")[0].replace(t,"$1")||null:null}function a(n,i){n&&n.attr("data-widget",d(i.constructor)||"unknown")}function s(){var i=this;this.widget=n.observable(null),this.dispose=function(){i.widget(null)}}function r(){var i=this,t="wnd",e={};this.windows=n.observableArray([]),this.update=function(n,o){var d=e[t+n];d||(d=new s(n),e[t+n]=d,i.windows.push(d)),d.widget(o)},this.remove=function(n){var o=e[t+n];o&&(o.dispose(),i.windows.remove(o))}}function u(){t.extend(this,[new r,'<div class="window-host" data-bind="foreach: windows"><div data-bind="inject: widget"></div></div>']),this.exportMethods("update","remove")}function c(){return w||(w=new u,w.appendTo(i("body")),w.init()),w}function l(i,t){var o=v++;n.computed({read:function(){var d=n.unwrap(t);n.dependencyDetection.ignore(function(){c().update(o,d),e(i,d)})},disposeWhenNodeIsRemoved:i}),n.utils.domNodeDisposal.addDisposeCallback(i,function(){c().remove(o),e(i,null)})}function f(i,t,d){if(n.bindingHandlers[t])throw new Error("Binding conflict. Binding '"+t+"' is already exist");n.bindingHandlers[t]={init:function(n,t){var e=new i;return d&&1==d.windowInject?l(n,e):o(n,e),d&&d.init&&d.init(e,t),{controlsDescendantBindings:!0}},update:function(i,t){var o=e(i);if(d&&d.update&&d.update(o,t),!d||!d.init&&!d.update){var a=n.toJS(t());n.dependencyDetection.ignore(function(){o.init(a)})}}}}t.extend=function(n,i){t.apply(n,i)};var p="__ko_widget__";n.bindingHandlers.inject={init:function(n,i){return o(n,i()),{controlsDescendantBindings:!0}},transition:function(n){n&&n.remove()}},n.bindingHandlers.windowInject={init:function(n,i){return l(n,i()),{controlsDescendantBindings:!0}}};var v=1,w=null;return n.bindingHandlers.injectAnimation={update:function(t,e){i(t).data("injectAnimation",n.unwrap(e()))},animations:{"default":function(n){n&&n.remove()},fadeIn:function(n,i){n&&n.remove(),n&&i&&i.hide().fadeIn()}}},n.bindingHandlers.inject.transition=function(i,t,e){var o=e.data("injectAnimation")||"default";if(o){var d=n.bindingHandlers.injectAnimation.animations[o];d&&d(i,t)}},t.inject=o,t.windowInject=l,t.registerBinding=f,n.Widget=n.widget=t,n.widgetFor=e,n.widget});